on:
  push:
    branches:
      - deploy/matrix

jobs:
  job1:
    runs-on: ubuntu-latest
    name: job1 before deploy
    steps:
    - name: job1 step 1
      run: echo "job1 step 1"

  job2:
    runs-on: ubuntu-latest
    name: job2 before deploy
    needs: job1
    outputs:
      date: ${{ steps.getDate.outputs.date }}
    steps:
    - name: job2 step 1
      run: echo "job2 step 1"
    - name: create output data
      id: getDate
      run: echo "::set-output name=date::$(date +'%Y.%m.%d.%H.%M.%S')"

  deploy:
    runs-on: ubuntu-latest
    needs: job2
    strategy:
      matrix:
        env: [ test, dev, prod ]
    environment:
      name: ${{ matrix.env }}
    steps:
    - name: ${{ matrix.env }} deploy step 1
      run: echo "env:${{ matrix.env }}@${{ needs.job2.outputs.date }}"


